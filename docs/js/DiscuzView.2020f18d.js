(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["DiscuzView"],{"629a":function(e,t,s){"use strict";s("f9d4")},bb62:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"discuz-page"},[s("div",{staticClass:"overflow-container",on:{scroll:e.onScroll}},[e.discuz.isLogin?e._e():s("div",{staticClass:"login-form"},[s("center",[s("h3",[e._v("discuz论坛手机版")])]),s("div",{staticClass:"input-warp"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.webSite,expression:"webSite"}],attrs:{name:"",id:"",placeholder:"请选择站点"},on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.webSite=t.target.multiple?s:s[0]}}},e._l(e.discuz.webSiteList,(function(t){return s("option",{key:t,domProps:{value:t}},[e._v(" "+e._s(t)+" ")])})),0),s("a",{staticClass:"btn",on:{click:e.updateWebSiteList}},[e._v("更新列表")])]),s("div",{staticClass:"input-warp"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userInfo.username,expression:"userInfo.username"}],attrs:{type:"text",placeholder:"请输入用户名"},domProps:{value:e.userInfo.username},on:{input:function(t){t.target.composing||e.$set(e.userInfo,"username",t.target.value)}}})]),s("div",{staticClass:"input-warp"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userInfo.password,expression:"userInfo.password"}],attrs:{type:"password",placeholder:"请输入密码"},domProps:{value:e.userInfo.password},on:{input:function(t){t.target.composing||e.$set(e.userInfo,"password",t.target.value)}}})]),s("div",{staticClass:"input-warp"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userInfo.QA,expression:"userInfo.QA"}],attrs:{type:"text",placeholder:"请输入问题ID和答案(以逗号分隔)"},domProps:{value:e.userInfo.QA},on:{input:function(t){t.target.composing||e.$set(e.userInfo,"QA",t.target.value)}}})]),s("a",{staticClass:"btn",on:{click:e.login}},[e._v("登录")])],1),e.discuz.isLogin?[s("ul",{staticClass:"user-info"},[s("router-link",{attrs:{to:{name:"DiscuzMyView"},tag:"li"}},[e._v(e._s(e.discuz.userInfo.username))]),e.discuz.signInfo.isSigned?s("li",[e._v("已签到")]):s("li",{on:{click:e.dailySignIn}},[e._v("日签到")]),s("li",{on:{click:e.monthSignIn}},[e._v("月签到")]),s("li",{on:{click:e.logout}},[e._v("退出")])],1),e._l(e.areaList,(function(t,i){return s("ul",{key:i,staticClass:"area",attrs:{"data-title":t.name}},e._l(t.value,(function(t,i){return s("router-link",{key:i,attrs:{to:{name:"DiscuzForumView",params:{url:t.value}},tag:"li"}},[e._v(e._s(t.name))])})),1)}))]:e._e(),s("a",{staticClass:"btn switch",on:{click:e.switchProxy}},[e._v("切换代理源("+e._s(e.proxyServerPlatom)+")")])],2)])},a=[],o=s("2f62"),n=s("adb5"),r=s("b383"),l=s.n(r),c=s("4260"),u={name:"discuz-page",components:{},data(){return{areaList:[],userInfo:{username:"",password:"",QA:""}}},computed:{...Object(o["d"])(["isLoading","discuz"]),...Object(o["c"])(["targetHost"]),webSite:{get(){return this.discuz.webSite},set(e){this.$store.commit("UPDATE_DISCUZ",{webSite:e})}},proxyServerPlatom(){return c["k"].filter(e=>e.host===this.discuz.HOST)[0].platom}},mounted(){},activated(){this.init(),console.log("isLogin:",this.discuz.isLogin,this.discuz.HOST),document.querySelector(".overflow-container").scrollTop=sessionStorage.getItem("homePage")||0},beforeMount(){},destroyed(){},methods:{...Object(o["b"])(["switchProxy","logout","submitPost","dailySignIn","monthSignIn","getPageData"]),async init(){let{isLogin:e,signInfo:t,webSiteList:s}=this.discuz;e?(t.isSigned||this.checkSigned(),this.getIndexPageData()):s.length||this.updateWebSiteList()},async login(){let{targetHost:e,discuz:{HOST:t},userInfo:{username:s,password:i,QA:a}}=this;if(s&&i){let o=a.split(","),r=o.length>1&&o[0]||null,u=o.length>1&&o[1]||null,d={formhash:"30b7da0e",cookietime:"315360000",loginfield:"username",questionid:r,answer:u,username:s,password:i,userlogin:"true"};r&&u||(delete d.questionid,delete d.answer);let m={httpConfig:{url:e+"logging.php?action=login&loginsubmit=true",method:"post",responseType:"arraybuffer",data:l.a.stringify(d)},encoding:"gbk"};this.$store.commit("SET_LOADING_STATUS",!0);let{headers:g}=await n["a"].post(t+"/api/advancedProxy",m);this.$store.commit("SET_LOADING_STATUS",!1),g.corscookies&&g.corscookies.split("|$$|").forEach(e=>{document.cookie=e}),this.$store.commit("UPDATE_DISCUZ",{isLogin:!!Object(c["e"])("cdb3_auth")}),this.checkSigned(),this.getIndexPageData()}},async checkSigned(){let{targetHost:e,discuz:{signInfo:t}}=this,s=e+"my.php",i=c["l"].my,a=await this.getPageData({url:s,selector:i}),{formhash:o,username:n,recentReply:r,recentTopics:l}=a;this.discuz.formhash=o,l&&l.forEach(e=>{e&&e.title==`${n}/${(new Date).getMonth()+1}月份/打卡签到帖`&&(e.lastPost.includes((new Date).Format("yyyy-M-d"))?t.isSigned=!0:t.tid=e.tid)})},async getIndexPageData(){let e=this.targetHost+"index.php",t=c["l"].index,s={};sessionStorage.getItem(e)?s=JSON.parse(sessionStorage.getItem(e)):(s=await this.getPageData({url:e,selector:t}),sessionStorage.setItem(e,JSON.stringify(s))),this.areaList=s.areaList;let i=Object.assign({},this.discuz.userInfo);i.creditList=s.creditList,i.username=s.username,this.$store.commit("UPDATE_DISCUZ",{userInfo:i}),s.username||this.logout()},async updateWebSiteList(){let e=c["k"].filter(e=>e.gfw),t=e[Math.floor(Math.random()*e.length)].host,s="http://www.oznewspaper.com/",i=c["l"].webSiteList,a=await this.getPageData({url:s,selector:i,HOST:t}),o=[];a.webSiteList.forEach(e=>{o.push(e.replace("\n","").replace(/ .*/g,""))}),localStorage.setItem("webSiteList",JSON.stringify(o)),this.$store.commit("UPDATE_DISCUZ",{webSiteList:o})},onScroll(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{sessionStorage.setItem("homePage",e.target.scrollTop)},100)}}},d=u,m=(s("629a"),s("2877")),g=Object(m["a"])(d,i,a,!1,null,"b6d4fcd4",null);t["default"]=g.exports},f9d4:function(e,t,s){}}]);