(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["DiscuzView"],{"1def":function(e,t,s){},b9ce:function(e,t,s){"use strict";var i=s("1def"),r=s.n(i);r.a},bb62:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"discuz-page"},[s("div",{staticClass:"overflow-container",on:{scroll:e.onScroll}},[e.discuz.isLogin?e._e():s("div",{staticClass:"login-form"},[s("center",[s("h3",[e._v("discuz论坛手机版")])]),s("div",{staticClass:"input-warp"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.webSite,expression:"webSite"}],attrs:{name:"",id:"",placeholder:"请选择站点"},on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){var t="_value"in e?e._value:e.value;return t});e.webSite=t.target.multiple?s:s[0]}}},e._l(e.discuz.webSiteList,function(t){return s("option",{key:t,domProps:{value:t}},[e._v(e._s(t))])}),0),s("a",{staticClass:"btn",on:{click:e.updateWebSiteList}},[e._v("更新列表")])]),s("div",{staticClass:"input-warp"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userInfo.username,expression:"userInfo.username"}],attrs:{type:"text",placeholder:"请输入用户名"},domProps:{value:e.userInfo.username},on:{input:function(t){t.target.composing||e.$set(e.userInfo,"username",t.target.value)}}})]),s("div",{staticClass:"input-warp"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userInfo.password,expression:"userInfo.password"}],attrs:{type:"password",placeholder:"请输入密码"},domProps:{value:e.userInfo.password},on:{input:function(t){t.target.composing||e.$set(e.userInfo,"password",t.target.value)}}})]),s("div",{staticClass:"input-warp"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.userInfo.QA,expression:"userInfo.QA"}],attrs:{type:"text",placeholder:"请输入问题ID和答案(以逗号分隔)"},domProps:{value:e.userInfo.QA},on:{input:function(t){t.target.composing||e.$set(e.userInfo,"QA",t.target.value)}}})]),s("a",{staticClass:"btn",on:{click:e.login}},[e._v("登录")])],1),e.discuz.isLogin?[s("ul",{staticClass:"user-info"},[s("router-link",{attrs:{to:{name:"DiscuzMyView"},tag:"li"}},[e._v(e._s(e.discuz.userInfo.username))]),e.discuz.signInfo.isSigned?s("li",[e._v("已签到")]):s("li",{on:{click:e.dailySignIn}},[e._v("日签到")]),s("li",{on:{click:e.monthSignIn}},[e._v("月签到")]),s("li",{on:{click:e.logout}},[e._v("退出")])],1),e._l(e.areaList,function(t,i){return s("ul",{key:i,staticClass:"area",attrs:{"data-title":t.name}},e._l(t.value,function(t,i){return s("router-link",{key:i,attrs:{to:{name:"DiscuzForumView",params:{url:e.targetHost+t.value}},tag:"li"}},[e._v(e._s(t.name))])}),1)})]:e._e(),s("a",{staticClass:"btn switch",on:{click:e.switchProxy}},[e._v("切换代理源("+e._s(e.proxyServerPlatom)+")")])],2)])},r=[],o=(s("a481"),s("ac6a"),s("28a5"),s("1da1")),a=s("ade3"),n=s("2f62"),c=s("adb5"),u=s("b383"),l=s.n(u),d=s("4260"),g=s("dc16"),p=s("db49");function m(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,i)}return s}function f(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?m(s,!0).forEach(function(t){Object(a["a"])(e,t,s[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):m(s).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))})}return e}var h={name:"discuz-page",components:{},data(){return{areaList:[],userInfo:{username:"",password:"",QA:""}}},computed:f({},Object(n["d"])(["isLoading","discuz"]),{},Object(n["c"])(["targetHost"]),{webSite:{get(){return this.discuz.webSite},set(e){this.$store.commit("UPDATE_DISCUZ",{webSite:e})}},proxyServerPlatom(){return p["a"].filter(e=>e.host===this.discuz.HOST)[0].platom}}),mounted(){},activated(){this.init(),console.log("isLogin:",this.discuz.isLogin,this.discuz.HOST),document.querySelector(".overflow-container").scrollTop=sessionStorage.getItem("homePage")||0},beforeMount(){},destroyed(){},methods:f({},Object(n["b"])(["switchProxy","logout","submitPost","dailySignIn","monthSignIn","getPageData"]),{init(){var e=this;return Object(o["a"])(function*(){let t=e.discuz,s=t.isLogin,i=t.signInfo,r=t.webSiteList;s?(i.isSigned||e.checkSigned(),e.getIndexPageData()):r.length||e.updateWebSiteList()})()},login(){var e=this;return Object(o["a"])(function*(){let t=e.targetHost,s=e.discuz.HOST,i=e.userInfo,r=i.username,o=i.password,a=i.QA;if(r&&o){let i=a.split(","),n=i.length>1&&i[0]||null,u=i.length>1&&i[1]||null,g={formhash:"30b7da0e",cookietime:"315360000",loginfield:"username",questionid:n,answer:u,username:r,password:o,userlogin:"true"};n&&u||(delete g.questionid,delete g.answer);let p={httpConfig:{url:`${t}logging.php?action=login&loginsubmit=true`,method:"post",responseType:"arraybuffer",data:l.a.stringify(g)},encoding:"gbk"};e.$store.commit("SET_LOADING_STATUS",!0);let m=yield c["a"].post(`${s}/api/advancedProxy`,p),f=m.headers;e.$store.commit("SET_LOADING_STATUS",!1),f.corscookies&&f.corscookies.split("|$$|").forEach(e=>{document.cookie=e}),e.$store.commit("UPDATE_DISCUZ",{isLogin:!!Object(d["e"])("cdb3_auth")}),e.checkSigned(),e.getIndexPageData()}})()},checkSigned(){var e=this;return Object(o["a"])(function*(){let t=e.targetHost,s=e.discuz.signInfo,i=`${t}my.php`,r=g["a"].my,o=yield e.getPageData({url:i,selector:r}),a=o.formhash,n=o.username,c=(o.recentReply,o.recentTopics);e.discuz.formhash=a,c&&c.forEach(e=>{e&&e.title==`${n}/${(new Date).getMonth()+1}月份/打卡签到帖`&&(e.lastPost.includes((new Date).Format("yyyy-M-d"))?s.isSigned=!0:s.tid=e.tid)})})()},getIndexPageData(){var e=this;return Object(o["a"])(function*(){let t=`${e.targetHost}index.php`,s=g["a"].index,i={};sessionStorage.getItem(t)?i=JSON.parse(sessionStorage.getItem(t)):(i=yield e.getPageData({url:t,selector:s}),sessionStorage.setItem(t,JSON.stringify(i))),e.areaList=i.areaList;let r=Object.assign({},e.discuz.userInfo);r.creditList=i.creditList,r.username=i.username,e.$store.commit("UPDATE_DISCUZ",{userInfo:r}),i.username||e.logout()})()},updateWebSiteList(){var e=this;return Object(o["a"])(function*(){let t=p["a"].filter(e=>e.gfw),s=t[Math.floor(Math.random()*t.length)].host,i="http://www.oznewspaper.com/",r=g["a"].webSiteList,o=yield e.getPageData({url:i,selector:r,HOST:s}),a=[];o.webSiteList.forEach(e=>{a.push(e.replace("\n","").replace(/ .*/g,""))}),localStorage.setItem("webSiteList",JSON.stringify(a)),e.$store.commit("UPDATE_DISCUZ",{webSiteList:a})})()},onScroll(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{sessionStorage.setItem("homePage",e.target.scrollTop)},100)}})},v=h,b=(s("b9ce"),s("2877")),w=Object(b["a"])(v,i,r,!1,null,"60b6cc3e",null);t["default"]=w.exports}}]);